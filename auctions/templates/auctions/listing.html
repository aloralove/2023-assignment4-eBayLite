{% extends "auctions/layout.html" %}

{% block main %}
{% if messages %}
  <ul class="messages">
      {% for message in messages %}
          <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
      {% endfor %}
  </ul>
{% endif %}
<h1>Listing</h1>

{% if listing.active %}
    <h3>{{ listing.title }}</h3>
    <p>{{ listing.description }}</p>
    <p>Starting Bid: {{ listing.starting_bid }}</p>
    <p>Category: {{ listing.category }}</p>
    <p><img src="{{ listing.image_url }}" alt="{{ listing.title }}"></p>

    <form action="{% url 'auctions:watchlist' listing.id %}" method="post">
        {% csrf_token %}
        <button type="submit">Add to Watchlist</button>
    </form>

    <form action="{% url 'auctions:bid' listing.id %}" method="post">
        {% csrf_token %}
        {{ bid_form }}
        <button type="submit">Bid</button>
    </form>

    <h2>Bids</h2>
    {% for bid in bids %}
        <p>{{ bid.amount }}</p>
    {% endfor %}

    {% if is_creator %}
        <form action="{% url 'auctions:close_listing' listing.id %}" method="post">
            {% csrf_token %}
            <button type="submit">Close Listing</button>
        </form>
    {% endif %}

    <h2>Leave a Comment</h2>
    <form action="{% url 'auctions:comment' listing.id %}" method="post">
        {% csrf_token %}
        {{ comment_form }}
        <button type="submit">Comment</button>
    </form>

    <h2>Comments</h2>
    {% for comment in comments %}
        <p>{{ comment.content }}</p>
    {% endfor %}
{% else %}
    <h2>LISTING CLOSED</h2>
    <!-- You can add more details about the closed listing here if needed -->
{% endif %}

{% endblock %}
